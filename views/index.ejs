<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Greeting Card Website</title>
  <link rel="stylesheet" href="/css/style.css"> <link rel="stylesheet" href="/css/button.css">
</head>
<body>
  <div class="container">
    <h1>Create Your Greeting Card</h1>
    <form id="greetingForm" action="/create-card" method="POST" enctype="multipart/form-data">
      
      <div class="form-group">
        <label for="senderName">Sender's Name:</label>
        <input type="text" id="senderName" name="senderName" required>
      </div>

      <div class="form-group">
        <label for="senderCountry">Sender's Country:</label>
        <input type="text" id="senderCountry" name="senderCountry" required>
      </div>

      <div class="form-group">
        <label for="receiverName">Receiver's Name:</label>
        <input type="text" id="receiverName" name="receiverName" required>
      </div>

      <div class="form-group">
        <label for="receiverCountry">Receiver's Country:</label>
        <input type="text" id="receiverCountry" name="receiverCountry" required>
      </div>

      <div class="form-group">
        <label for="deliveryDate">Delivery Date and Time:</label>
        <input type="datetime-local" id="deliveryDate" name="deliveryDate" required>
      </div>

      <div class="form-group">
        <label for="message">Message:</label>
        <textarea id="message" name="message" required></textarea>
      </div>

      <div class="form-group">
        <label for="song">Background Song:</label>
        <input type="text" id="songSearch" placeholder="Search for a song">
        <div id="songResults"></div>
        <input type="hidden" id="selectedSong" name="selectedSong">
      </div>
<br>
      <div class="form-group">
        <label for="image">Upload Image:</label>
        <input type="file" id="image" name="image" accept="image/*">
      </div>

      <div class="form-group">
        <label for="voiceNote">Upload Voice Note:</label>
        <input type="file" id="voiceNote" name="voiceNote" accept="audio/*">
      </div>
<br>
<div style="text-align: center;">
      <button type="submit" id="submitBtn" class="order"><span class="default">Create Card</span><span class="success">Card Created<svg viewbox="0 0 12 10">
        <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
    </svg></span>
<div class="box"></div>
<div class="truck">
    <div class="back"></div>
    <div class="front">
        <div class="window"></div>
    </div>
    <div class="light top"></div>
    <div class="light bottom"></div>
</div>
<div class="lines"></div>
</button>
</div>
    </form>
  </div>

  <script>
    // Song Search Script
    const songSearch = document.getElementById('songSearch');
    const songResults = document.getElementById('songResults');
    const selectedSong = document.getElementById('selectedSong');
  
    songSearch.addEventListener('input', async (e) => {
      const query = e.target.value;
      if (query.length > 2) {
        const response = await fetch(`/search-song?query=${encodeURIComponent(query)}`);
        const data = await response.json();
        displaySongResults(data.results.trackmatches.track);
      }
    });
  
    function displaySongResults(tracks) {
      songResults.innerHTML = '';
      tracks.forEach(track => {
        const div = document.createElement('div');
        div.classList.add('song-item');
        div.textContent = `${track.name} - ${track.artist}`;
        div.addEventListener('click', () => {
          selectedSong.value = JSON.stringify(track);
          songSearch.value = `${track.name} - ${track.artist}`;
          songResults.innerHTML = '';
        });
        songResults.appendChild(div);
      });
    }

    // Submit button delay
    const form = document.getElementById('greetingForm');
    const submitBtn = document.getElementById('submitBtn');
    form.addEventListener('submit', function (e) {
      e.preventDefault();  
      submitBtn.disabled = true;  
      setTimeout(() => {
        form.submit(); 
      }, 5500); 
    });
  </script>
  <script>
    document.getElementById('greetingForm').addEventListener('submit', function (e) {
      e.preventDefault(); // Prevent default form submission

      // Get the delivery date input
      const deliveryDateInput = document.getElementById('deliveryDate');
      const localDateTime = new Date(deliveryDateInput.value);

      // Manually subtract 5 hours and 30 minutes (IST offset from UTC)
      const istOffset = 5 * 60 + 30; // 5 hours 30 minutes in minutes
      const utcDateTime = new Date(localDateTime.getTime() - istOffset * 60000);

      // Convert it to the format required by Firebase
      const utcDateString = utcDateTime.toISOString().slice(0, 16); // Keep YYYY-MM-DDTHH:MM format

      // Set the deliveryDate input value to the corrected UTC time
      deliveryDateInput.value = utcDateString;

      // Now submit the form
      this.submit();
    });
  </script>
  <script src="/js/main.js"></script>
<script src="/js/track.js"></script>
</body>
</html>
